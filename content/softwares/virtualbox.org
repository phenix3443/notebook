# -*- coding:utf-8-*-
#+TITLE: virtualbox 使用
#+AUTHOR: liushangliang
#+EMAIL: phenix3443+github@gmail.com

* 概述

* secure boot[fn:1]
  Create signing keys
  #+BEGIN_SRC sh
openssl req -new -x509 -newkey rsa:2048 -keyout MOK.priv -outform DER -out MOK.der -nodes -days 36500 -subj "/CN=vbox_sign_key/"
  #+END_SRC
  Register the keys to Secure Boot
      #+BEGIN_SRC sh
sudo mokutil --import MOK.der
      #+END_SRC
  Supply a password for later use after reboot

  Reboot and follow instructions to Enroll MOK (Machine Owner Key). Here's a [[https://sourceware.org/systemtap/wiki/SecureBoot][sample]] with pictures. The system will reboot one more time. After the reboot, you may also need to sudo modprobe vboxdrv to load the module.

  Sign the module
  #+BEGIN_SRC sh
sudo /usr/src/linux-headers-$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxdrv)
  #+END_SRC

  此处使用 vbox_sign.sh 批量给 module 添加签名。 *注意不要再次执行/sbin/vboxconfig*

* Footnotes

[fn:1] https://askubuntu.com/questions/760671/could-not-load-vboxdrv-after-upgrade-to-ubuntu-16-04-and-i-want-to-keep-secur
