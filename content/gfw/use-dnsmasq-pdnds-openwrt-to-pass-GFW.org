# -*- coding:utf-8-*-
#+TITLE: 通过 openwrt 翻墙
#+AUTHOR: liushangliang
#+EMAIL: phenix3443+github@gmail.com

好久没有更新博客了，最近一周都在尝试使用 openwrt 作为二级路由进行整个局域网的翻墙。今天顺便把我使用过的翻墙技术总结一下，比较一下优劣。

首先，一个理想的翻墙环境应该是这样的：

1.DNS 解析要能兼顾防污染和 CDN 网络。

2.IP 智能解析，国内能访问的直连，访问速度过慢甚至不能访问的通过代理直接访问。

3.不影响 SSL 证书。

4.过滤广告。

看起来是很简单的要求，但是自从大学之后经历了诸多翻墙软件之后，目前能够满意的还是 GoAgent 或者 shadowsocks+vps。

这两天尝试通过 openwrt 上面一些软件达到智能上网的目的，主要使用的软件有如下几种：

1.chinaDns，chinaDns 配置国内 DNS 和第三方抗污染的 DNS，虽然能实现 DNS 解析分流，但是需要维护一个域名白名单。

2.dnsmasq，有 dns cache 和分流的功能。同时还有 dhcp 的功能。但是不支持 dns 请求通过 tcp 进行查询，也就是不能抗污染。

3.pdnsd，有 dns cache 的作用，但主要作用还是做通过 tcp 进行 dns 请求的转发。

通过这两天的尝试，主要问题如下：

1.不能智能区分一个域名到底是走国内还是国外。

2.不能智能区分一个 IP 应该直连还是走代理通道。有人直接将 SS 设为透明代理，然后给国内 IP 设置白名单，但是代理软件天生的速度缺陷并不适合这样做。

3.通过 VPS，包括我自己也在 DO 上面搭建了一个，但是宽带上（长城宽带）还是很大程度上影响代理的连接速度。并不适合所有国外流量都走代理通道。
